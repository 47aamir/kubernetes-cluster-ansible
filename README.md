# Kubernetes Cluster Setup with Ansible

This repository provides an Ansible playbook for setting up a Kubernetes cluster with both master and worker nodes. It automates the installation and configuration of Kubernetes, Docker, and necessary dependencies.

## Prerequisites

Before running the playbook, ensure the following prerequisites are met:

### 1. Install Ansible on the Control Machine

Ansible needs to be installed on the machine from which you will run the playbook. You can install Ansible using `pip`:

```bash
pip install ansible
```
Alternatively, you can install Ansible using your package manager:

For Ubuntu/Debian:
```
sudo apt update
sudo apt install ansible
```
For CentOS/RHEL:
```
sudo yum install epel-release
sudo yum install ansible
```

### 2. SSH Access to All Nodes
Ensure that you have SSH access to all nodes (both master and worker nodes). You should be able to SSH into each node without being prompted for a password. To achieve this, set up SSH keys:

Generate an SSH key pair on your control machine if you donâ€™t already have one:
```
ssh-keygen
```

Copy the public key to all nodes:
```
ssh-copy-id user@node-ip-address
```
### 3. Configure Passwordless sudo
Ensure that the user running the Ansible playbook has passwordless sudo privileges on all nodes. To do this, add the following line to the /etc/sudoers file for the user:
```
your_username ALL=(ALL) NOPASSWD:ALL
```

### Inventory File
Create an inventory file to define your master and worker nodes. Example inventory.ini:

```
[master]
master-node-1 ansible_host=192.168.1.100

[worker]
worker-node-1 ansible_host=192.168.1.101
worker-node-2 ansible_host=192.168.1.102
```

### Usage
1. Clone the repository:
```
git clone https://github.com/your-username/kubernetes-cluster-setup.git
cd kubernetes-cluster-setup
```
2. Run the playbook:
```
ansible-playbook -i inventory.ini k8s-setup.yml
```
### Playbook Details
k8s-setup.yml

The playbook is divided into three main sections:

1. Common Setup:
    - Updates apt and installs required packages
    - Adds Kubernetes repository and installs Kubernetes and Docker packages
    - Holds Kubernetes packages to prevent unintended upgrades
    - Enables and starts kubelet and docker services
    - Disables swap
    - Downloads and installs cri-dockerd

2. Master Node Setup:
    - Pulls Kubernetes control plane images
    - Initializes the Kubernetes cluster
    - Sets up Kubernetes admin configuration
    - Applies the Flannel network for pod communication
    - Generates a join command for worker nodes

3. Worker Node Setup:
    - Uses the join command generated by the master node to join the cluster

### Example Output
Once the playbook runs successfully, you should see output indicating that the master node has been initialized and worker nodes have joined the cluster. You can verify the setup by running:
```
kubectl get nodes
```
This command should list all master and worker nodes in your cluster.

### Troubleshooting
If you encounter any issues during the setup, consider the following steps:

- Ensure SSH access is properly configured and you can manually SSH into each node.
- Verify that your inventory file correctly lists all nodes with their respective IP addresses.
- Check the Ansible playbook output for any error messages and address them accordingly.

### Contributions
Contributions are welcome! Please fork this repository and submit pull requests.

### License
This project is licensed under the MIT License - see the [LICENSE](./LICENSE) file for details.
